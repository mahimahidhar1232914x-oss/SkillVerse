import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import 'dart:async'; // Required for Timer, though not directly used in this implementation, it's good practice for scheduling-related features.
import 'package:animations/animations.dart'; // For advanced page transitions
import 'package:google_fonts/google_fonts.dart'; // For enhanced typography

// Define a custom color scheme for a high-end look
final ColorScheme _customColorScheme = const ColorScheme.light(
  primary: Color(0xFF1A237E), // Deep Indigo for primary actions and branding
  primaryContainer: Color(0xFF3F51B5), // Lighter indigo for variations
  secondary: Color(0xFFFFC107), // Amber for accent and highlights
  secondaryContainer: Color(0xFFFFD54F), // Lighter amber
  surface: Colors.white, // White for card backgrounds, etc.
  background: Color(0xFFF0F2F5), // Light grey for general background
  error: Color(0xFFB00020), // Standard error red
  onPrimary: Colors.white, // White text on primary
  onSecondary: Colors.black, // Black text on secondary
  onSurface: Colors.black, // Black text on surface
  onBackground: Colors.black, // Black text on background
  onError: Colors.white, // White text on error
  brightness: Brightness.light,
);

void main() {
  runApp(
    ChangeNotifierProvider<CourseData>(
      create: (BuildContext context) => CourseData(),
      builder: (BuildContext context, Widget? child) => const SkillVerseApp(),
    ),
  );
}

class Course {
  final String title;
  final String instructor;
  final String imageUrl;
  final String description;

  Course({
    required this.title,
    required this.instructor,
    required this.imageUrl,
    required this.description,
  });

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is Course &&
          runtimeType == other.runtimeType &&
          title == other.title &&
          instructor == other.instructor;

  @override
  int get hashCode => title.hashCode ^ instructor.hashCode;
}

class ScheduledClass {
  final Course course;
  final DateTime scheduledTime;

  ScheduledClass({required this.course, required this.scheduledTime});

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is ScheduledClass &&
          runtimeType == other.runtimeType &&
          course == other.course &&
          scheduledTime == other.scheduledTime;

  @override
  int get hashCode => course.hashCode ^ scheduledTime.hashCode;
}

class CourseData extends ChangeNotifier {
  final List<Course> _availableCourses = <Course>[
    Course(
      title: "Flutter for Beginners",
      instructor: "John Doe",
      imageUrl:
          "https://www.gstatic.com/flutter-onestack-prototype/genui/example_1.jpg", // Placeholder URL
      description: "Learn how to build beautiful apps with Flutter.",
    ),
    Course(
      title: "Data Science 101",
      instructor: "Jane Smith",
      imageUrl:
          "https://www.gstatic.com/flutter-onestack-prototype/genui/example_1.jpg", // Placeholder URL
      description:
          "An introduction to data science and machine learning concepts.",
    ),
    Course(
      title: "Web Development Bootcamp",
      instructor: "Alex Johnson",
      imageUrl:
          "https://www.gstatic.com/flutter-onestack-prototype/genui/example_1.jpg", // Placeholder URL
      description: "Become a full-stack web developer from scratch.",
    ),
    Course(
      title: "Machine Learning with Python",
      instructor: "Dr. Anna Lee",
      imageUrl:
          "https://www.gstatic.com/flutter-onestack-prototype/genui/example_1.jpg", // Placeholder URL
      description:
          "Dive deep into machine learning algorithms using Python.",
    ),
    Course(
      title: "Mobile App Design Principles",
      instructor: "Sarah Connor",
      imageUrl:
          "https://www.gstatic.com/flutter-onestack-prototype/genui/example_1.jpg", // Placeholder URL
      description:
          "Master the art of designing intuitive and engaging mobile apps.",
    ),
  ];

  final List<Course> _enrolledCourses = <Course>[];
  final List<ScheduledClass> _scheduledClasses = <ScheduledClass>[];

  List<Course> get availableCourses =>
      List<Course>.unmodifiable(_availableCourses);
  List<Course> get enrolledCourses =>
      List<Course>.unmodifiable(_enrolledCourses);
  List<ScheduledClass> get scheduledClasses =>
      List<ScheduledClass>.unmodifiable(_scheduledClasses);

  bool isEnrolled(Course course) => _enrolledCourses.contains(course);

  void enrollCourse(Course course) {
    if (!_enrolledCourses.contains(course)) {
      _enrolledCourses.add(course);
      notifyListeners();
    }
  }

  void unenrollCourse(Course course) {
    _enrolledCourses.remove(course);
    _scheduledClasses.removeWhere(
        (ScheduledClass scheduledClass) => scheduledClass.course == course);
    notifyListeners();
  }

  void scheduleClass(Course course, DateTime dateTime) {
    // Prevent scheduling the same course at the exact same time
    if (!_scheduledClasses.any(
        (ScheduledClass sc) => sc.course == course && sc.scheduledTime.isAtSameMomentAs(dateTime))) {
      _scheduledClasses.add(ScheduledClass(course: course, scheduledTime: dateTime));
      _scheduledClasses.sort((ScheduledClass a, ScheduledClass b) => a.scheduledTime.compareTo(b.scheduledTime));
      notifyListeners();
    }
  }

  void removeScheduledClass(ScheduledClass scheduledClass) {
    _scheduledClasses.remove(scheduledClass);
    notifyListeners();
  }
}

class SkillVerseApp extends StatelessWidget {
  const SkillVerseApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'SkillVerse',
      theme: ThemeData(
        colorScheme: _customColorScheme,
        useMaterial3: true,
        appBarTheme: AppBarTheme(
          backgroundColor: _customColorScheme.primary,
          foregroundColor: _customColorScheme.onPrimary,
          elevation: 0, // Flat app bar for modern look
          titleTextStyle: GoogleFonts.poppins(
            color: _customColorScheme.onPrimary,
            fontSize: 22,
            fontWeight: FontWeight.w600,
          ),
          iconTheme: IconThemeData(color: _customColorScheme.onPrimary),
        ),
        cardTheme: CardThemeData(
          elevation: 8, // Higher elevation for a more premium feel
          shape:
              RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)), // More rounded corners
          surfaceTintColor: _customColorScheme.surface, // Cards use surface color
          shadowColor: Colors.black.withOpacity(0.1), // Subtle shadow
        ),
        elevatedButtonTheme: ElevatedButtonThemeData(
          style: ElevatedButton.styleFrom(
            backgroundColor: _customColorScheme.primary,
            foregroundColor: _customColorScheme.onPrimary,
            padding:
                const EdgeInsets.symmetric(horizontal: 24, vertical: 16), // Slightly larger padding
            shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(12)), // More rounded
            textStyle:
                GoogleFonts.poppins(fontSize: 18, fontWeight: FontWeight.w600), // Custom font
            elevation: 4, // Subtle elevation
          ),
        ),
        outlinedButtonTheme: OutlinedButtonThemeData(
          style: OutlinedButton.styleFrom(
            foregroundColor: _customColorScheme.primary,
            side: BorderSide(color: _customColorScheme.primary, width: 2),
            padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
            shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
            textStyle: GoogleFonts.poppins(fontSize: 16, fontWeight: FontWeight.w500),
          ),
        ),
        inputDecorationTheme: InputDecorationTheme(
          filled: true,
          fillColor: _customColorScheme.surface,
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide.none, // No border by default
          ),
          focusedBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide:
                BorderSide(color: _customColorScheme.primary, width: 2), // Primary color on focus
          ),
          enabledBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide(
                color: _customColorScheme.onBackground.withOpacity(0.2), width: 1),
          ),
          labelStyle:
              GoogleFonts.poppins(color: _customColorScheme.onBackground.withOpacity(0.7)),
          hintStyle:
              GoogleFonts.poppins(color: _customColorScheme.onBackground.withOpacity(0.5)),
          prefixIconColor: _customColorScheme.onBackground.withOpacity(0.6),
          contentPadding: const EdgeInsets.symmetric(vertical: 16, horizontal: 20),
        ),
        textTheme: GoogleFonts.poppinsTextTheme(
          Theme.of(context).textTheme, // Base theme text styles
        ),
      ),
      home: const LoginScreen(),
    );
  }
}

class LoginScreen extends StatefulWidget {
  const LoginScreen({super.key});

  @override
  State<LoginScreen> createState() => _LoginScreenState();
}

class _LoginScreenState extends State<LoginScreen> {
  final TextEditingController _emailController =
      TextEditingController(text: 'user@example.com');
  final TextEditingController _passwordController =
      TextEditingController(text: 'password123');
  final GlobalKey<FormState> _formKey = GlobalKey<FormState>();

  void _login() {
    if (_formKey.currentState!.validate()) {
      // Simulate login success
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Login Successful!')),
      );
      Navigator.pushReplacement(
        context,
        PageRouteBuilder<void>(
          transitionDuration: const Duration(milliseconds: 600),
          pageBuilder:
              (BuildContext context, Animation<double> animation, Animation<double> secondaryAnimation) =>
                  const HomePage(),
          transitionsBuilder: (BuildContext context, Animation<double> animation,
              Animation<double> secondaryAnimation, Widget child) {
            return FadeThroughTransition(
                animation: animation,
                secondaryAnimation: secondaryAnimation,
                child: child);
          },
        ),
      );
    }
  }

  @override
  void dispose() {
    _emailController.dispose();
    _passwordController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Login')),
      body: Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
            colors: <Color>[
              _customColorScheme.background,
              _customColorScheme.primary.withOpacity(0.1),
            ],
          ),
        ),
        child: Center(
          child: SingleChildScrollView(
            padding: const EdgeInsets.all(24.0),
            child: Form(
              key: _formKey,
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: <Widget>[
                  Icon(
                    Icons.school_outlined, // Slightly different icon for modern look
                    size: 120, // Larger icon
                    color: _customColorScheme.primary,
                  ),
                  const SizedBox(height: 30),
                  Text(
                    'Welcome to SkillVerse', // Changed app name
                    style: Theme.of(context).textTheme.headlineMedium?.copyWith(
                          fontWeight: FontWeight.bold,
                          color: _customColorScheme.primary,
                        ),
                  ),
                  const SizedBox(height: 30),
                  TextFormField(
                    controller: _emailController,
                    decoration: const InputDecoration(
                      labelText: 'Email',
                      prefixIcon: Icon(Icons.email),
                    ),
                    keyboardType: TextInputType.emailAddress,
                    validator: (String? value) {
                      if (value == null || value.isEmpty) {
                        return 'Please enter your email';
                      }
                      if (!value.contains('@')) {
                        return 'Please enter a valid email';
                      }
                      return null;
                    },
                  ),
                  const SizedBox(height: 20),
                  TextFormField(
                    controller: _passwordController,
                    decoration: const InputDecoration(
                      labelText: 'Password',
                      prefixIcon: Icon(Icons.lock),
                    ),
                    obscureText: true,
                    validator: (String? value) {
                      if (value == null || value.isEmpty) {
                        return 'Please enter your password';
                      }
                      if (value.length < 6) {
                        return 'Password must be at least 6 characters';
                      }
                      return null;
                    },
                  ),
                  const SizedBox(height: 30),
                  SizedBox(
                    width: double.infinity,
                    child: ElevatedButton(
                      onPressed: _login,
                      child: const Text('Login'),
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}

class HomePage extends StatefulWidget {
  const HomePage({super.key});

  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage>
    with SingleTickerProviderStateMixin {
  late TabController _tabController;

  @override
  void initState() {
    super.initState();
    _tabController = TabController(length: 2, vsync: this);
  }

  @override
  void dispose() {
    _tabController.dispose();
    super.dispose();
  }

  void _goToCoursesTab() {
    _tabController.animateTo(0);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('SkillVerse'), // Changed app name
        bottom: TabBar(
          controller: _tabController,
          indicatorColor: _customColorScheme.secondary, // Accent color for indicator
          labelColor: _customColorScheme.onPrimary, // White text for selected tab
          unselectedLabelColor: _customColorScheme.onPrimary.withOpacity(0.7), // Slightly faded for unselected
          tabs: const <Tab>[
            Tab(icon: Icon(Icons.school_outlined), text: 'Courses'), // Updated icon
            Tab(icon: Icon(Icons.calendar_month_outlined), text: 'My Schedule'), // Updated icon
          ],
        ),
      ),
      body: TabBarView(
        controller: _tabController,
        children: <Widget>[
          const CourseListPage(),
          SchedulePage(goToCoursesTab: _goToCoursesTab), // Pass callback
        ],
      ),
    );
  }
}

class CourseListPage extends StatelessWidget {
  const CourseListPage({super.key});

  @override
  Widget build(BuildContext context) {
    final CourseData courseData = Provider.of<CourseData>(context);

    return Scaffold(
      body: courseData.availableCourses.isEmpty
          ? Center(
              child: Text(
                'No courses available.',
                style: Theme.of(context).textTheme.headlineSmall,
              ),
            )
          : ListView.builder(
              itemCount: courseData.availableCourses.length,
              itemBuilder: (BuildContext context, int index) {
                final Course course = courseData.availableCourses[index];
                return CourseCard(course: course);
              },
            ),
    );
  }
}

class CourseCard extends StatelessWidget {
  final Course course;

  const CourseCard({super.key, required this.course});

  @override
  Widget build(BuildContext context) {
    final CourseData courseData = Provider.of<CourseData>(context);
    final bool isEnrolled = courseData.isEnrolled(course);

    return Card(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      child: InkWell(
        onTap: () {
          Navigator.push(
            context,
            PageRouteBuilder<void>(
              transitionDuration: const Duration(milliseconds: 600),
              pageBuilder: (BuildContext context, Animation<double> animation,
                      Animation<double> secondaryAnimation) =>
                  CourseDetailPage(course: course),
              transitionsBuilder: (BuildContext context, Animation<double> animation,
                  Animation<double> secondaryAnimation, Widget child) {
                return FadeThroughTransition(
                    animation: animation,
                    secondaryAnimation: secondaryAnimation,
                    child: child);
              },
            ),
          );
        },
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Row(
            children: <Widget>[
              Hero(
                tag: 'courseImage-${course.title}', // Unique tag for Hero animation
                child: ClipRRect(
                  borderRadius: BorderRadius.circular(8.0),
                  child: Image.network(
                    course.imageUrl,
                    width: 80,
                    height: 80,
                    fit: BoxFit.cover,
                    semanticLabel:
                        'Student studying for ${course.title}', // Added semantic label for accessibility
                  ),
                ),
              ),
              const SizedBox(width: 16),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: <Widget>[
                    Text(
                      course.title,
                      style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            fontWeight: FontWeight.bold,
                            color: _customColorScheme.onSurface,
                          ),
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                    const SizedBox(height: 4),
                    Text(
                      "By ${course.instructor}",
                      style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                            color: Colors.grey[700],
                          ),
                    ),
                    const SizedBox(height: 8),
                    if (isEnrolled)
                      Container(
                        padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
                        decoration: BoxDecoration(
                          color: Colors.green.shade100,
                          borderRadius: BorderRadius.circular(5),
                        ),
                        child: Text(
                          'Enrolled',
                          style: Theme.of(context).textTheme.bodySmall?.copyWith(
                                color: Colors.green.shade800,
                                fontWeight: FontWeight.bold,
                              ),
                        ),
                      ),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class CourseDetailPage extends StatelessWidget {
  final Course course;

  const CourseDetailPage({super.key, required this.course});

  Future<void> _selectDateTime(BuildContext context, CourseData courseData) async {
    final DateTime? pickedDate = await showDatePicker(
      context: context,
      initialDate: DateTime.now(),
      firstDate: DateTime.now(),
      lastDate: DateTime.now().add(const Duration(days: 365)),
      builder: (BuildContext context, Widget? child) {
        return Theme(
          data: ThemeData.light().copyWith(
            colorScheme: _customColorScheme.copyWith(
              primary: _customColorScheme.primary,
              onPrimary: _customColorScheme.onPrimary,
              surface: _customColorScheme.surface,
              onSurface: _customColorScheme.onBackground,
              secondary: _customColorScheme.secondary,
              onSecondary: _customColorScheme.onSecondary,
            ),
            textButtonTheme: TextButtonThemeData(
              style: TextButton.styleFrom(
                foregroundColor: _customColorScheme.primary, // dialog button
              ),
            ),
          ),
          child: child!,
        );
      },
    );

    if (pickedDate != null) {
      final TimeOfDay? pickedTime = await showTimePicker(
        context: context,
        initialTime: TimeOfDay.now(),
        builder: (BuildContext context, Widget? child) {
          return Theme(
            data: ThemeData.light().copyWith(
              colorScheme: _customColorScheme.copyWith(
                primary: _customColorScheme.primary,
                onPrimary: _customColorScheme.onPrimary,
                surface: _customColorScheme.surface,
                onSurface: _customColorScheme.onBackground,
                secondary: _customColorScheme.secondary,
                onSecondary: _customColorScheme.onSecondary,
              ),
              textButtonTheme: TextButtonThemeData(
                style: TextButton.styleFrom(
                  foregroundColor: _customColorScheme.primary, // dialog button
                ),
              ),
            ),
            child: child!,
          );
        },
      );

      if (pickedTime != null) {
        final DateTime selectedDateTime = DateTime(
          pickedDate.year,
          pickedDate.month,
          pickedDate.day,
          pickedTime.hour,
          pickedTime.minute,
        );
        courseData.scheduleClass(course, selectedDateTime);
        if (context.mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(
                content: Text('Scheduled "${course.title}" for '
                    '${selectedDateTime.month}/${selectedDateTime.day} '
                    '${selectedDateTime.hour.toString().padLeft(2, '0')}:'
                    '${selectedDateTime.minute.toString().padLeft(2, '0')}')),
          );
        }
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final CourseData courseData = Provider.of<CourseData>(context);
    final bool isEnrolled = courseData.isEnrolled(course);

    return Scaffold(
      appBar: AppBar(title: Text(course.title)),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: <Widget>[
            Hero(
              tag: 'courseImage-${course.title}', // Same tag for Hero animation
              child: ClipRRect(
                borderRadius: BorderRadius.circular(12.0),
                child: Image.network(
                  course.imageUrl,
                  height: 220,
                  width: double.infinity,
                  fit: BoxFit.cover,
                  semanticLabel:
                      'Student studying for ${course.title}', // Added semantic label
                ),
              ),
            ),
            const SizedBox(height: 24),
            Text(
              course.title,
              style: Theme.of(context).textTheme.headlineMedium?.copyWith(
                    fontWeight: FontWeight.bold,
                    color: _customColorScheme.primary,
                  ),
            ),
            const SizedBox(height: 8),
            Text(
              "Instructor: ${course.instructor}",
              style: Theme.of(context).textTheme.titleMedium?.copyWith(
                    color: Colors.grey[800],
                  ),
            ),
            const SizedBox(height: 16),
            const Divider(),
            const SizedBox(height: 16),
            Text(
              'About this course:',
              style: Theme.of(context).textTheme.titleLarge?.copyWith(
                    fontWeight: FontWeight.bold,
                  ),
            ),
            const SizedBox(height: 8),
            Text(
              course.description,
              style: Theme.of(context).textTheme.bodyLarge,
            ),
            const SizedBox(height: 30),
            Center(
              child: AnimatedSwitcher(
                duration: const Duration(milliseconds: 300),
                transitionBuilder: (Widget child, Animation<double> animation) {
                  return FadeTransition(opacity: animation, child: child);
                },
                child: isEnrolled
                    ? Column(
                        key: const ValueKey<bool>(true), // Key helps AnimatedSwitcher
                        children: <Widget>[
                          ElevatedButton.icon(
                            onPressed: () => _selectDateTime(context, courseData),
                            icon: const Icon(Icons.alarm_add),
                            label: const Text('Schedule Reminder'),
                          ),
                          const SizedBox(height: 10),
                          OutlinedButton.icon(
                            onPressed: () {
                              courseData.unenrollCourse(course);
                              ScaffoldMessenger.of(context).showSnackBar(
                                SnackBar(content: Text('Unenrolled from "${course.title}"')),
                              );
                              Navigator.pop(context); // Go back after unenroll
                            },
                            icon: Icon(Icons.exit_to_app, color: _customColorScheme.error),
                            label: Text('Unenroll', style: TextStyle(color: _customColorScheme.error)),
                            style: OutlinedButton.styleFrom(
                              side: BorderSide(color: _customColorScheme.error),
                              padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
                              shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
                            ),
                          ),
                        ],
                      )
                    : ElevatedButton.icon(
                        key: const ValueKey<bool>(false), // Key helps AnimatedSwitcher
                        onPressed: () {
                          courseData.enrollCourse(course);
                          ScaffoldMessenger.of(context).showSnackBar(
                            SnackBar(content: Text('Enrolled in "${course.title}"')),
                          );
                        },
                        icon: const Icon(Icons.add_task),
                        label: const Text('Enroll Now'),
                      ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

class SchedulePage extends StatelessWidget {
  final VoidCallback goToCoursesTab; // Add callback for "Explore Courses" button
  const SchedulePage({super.key, required this.goToCoursesTab});

  @override
  Widget build(BuildContext context) {
    final CourseData courseData = Provider.of<CourseData>(context);
    final List<ScheduledClass> scheduledClasses = courseData.scheduledClasses;

    return Scaffold(
      body: scheduledClasses.isEmpty
          ? Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: <Widget>[
                  Icon(Icons.calendar_month_outlined, size: 100, color: Colors.grey.shade400),
                  const SizedBox(height: 24),
                  Text(
                    'No classes scheduled yet.',
                    style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                          color: Colors.grey.shade600,
                          fontWeight: FontWeight.w600,
                        ),
                  ),
                  const SizedBox(height: 12),
                  Padding(
                    padding: const EdgeInsets.symmetric(horizontal: 32.0),
                    child: Text(
                      'Enroll in courses and schedule reminders from their details page to see them here!',
                      textAlign: TextAlign.center,
                      style: Theme.of(context).textTheme.bodyLarge?.copyWith(color: Colors.grey.shade500),
                    ),
                  ),
                  const SizedBox(height: 30),
                  ElevatedButton.icon(
                    onPressed: goToCoursesTab, // Use the callback
                    icon: const Icon(Icons.school_outlined),
                    label: const Text('Explore Courses'),
                  ),
                ],
              ),
            )
          : ListView.builder(
              itemCount: scheduledClasses.length,
              itemBuilder: (BuildContext context, int index) {
                final ScheduledClass scheduledClass = scheduledClasses[index];
                return ScheduleItemCard(scheduledClass: scheduledClass);
              },
            ),
    );
  }
}

class ScheduleItemCard extends StatelessWidget {
  final ScheduledClass scheduledClass;

  const ScheduleItemCard({super.key, required this.scheduledClass});

  @override
  Widget build(BuildContext context) {
    final CourseData courseData = Provider.of<CourseData>(context);
    final String formattedDate =
        '${scheduledClass.scheduledTime.month.toString().padLeft(2, '0')}/'
        '${scheduledClass.scheduledTime.day.toString().padLeft(2, '0')} '
        '${scheduledClass.scheduledTime.year}';
    final String formattedTime =
        '${scheduledClass.scheduledTime.hour.toString().padLeft(2, '0')}:'
        '${scheduledClass.scheduledTime.minute.toString().padLeft(2, '0')}';

    return Card(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      child: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: <Widget>[
            Row(
              children: <Widget>[
                Icon(Icons.access_time_filled, color: _customColorScheme.primary), // Filled icon
                const SizedBox(width: 8),
                Text(
                  '$formattedDate at $formattedTime',
                  style: Theme.of(context).textTheme.titleMedium?.copyWith(
                        fontWeight: FontWeight.bold,
                        color: _customColorScheme.primary,
                      ),
                ),
                const Spacer(),
                IconButton(
                  icon: Icon(Icons.delete_forever_outlined, color: _customColorScheme.error), // Outlined icon
                  onPressed: () {
                    courseData.removeScheduledClass(scheduledClass);
                    ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(content: Text('Removed reminder for "${scheduledClass.course.title}"')),
                    );
                  },
                ),
              ],
            ),
            const SizedBox(height: 12),
            Text(
              scheduledClass.course.title,
              style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                    fontWeight: FontWeight.bold,
                    color: _customColorScheme.onSurface,
                  ),
              maxLines: 2,
              overflow: TextOverflow.ellipsis,
            ),
            const SizedBox(height: 4),
            Text(
              "Instructor: ${scheduledClass.course.instructor}",
              style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                    color: Colors.grey[700],
                  ),
            ),
            const SizedBox(height: 12),
            Align(
              alignment: Alignment.bottomRight,
              child: OutlinedButton(
                onPressed: () {
                  Navigator.push(
                    context,
                    PageRouteBuilder<void>(
                      transitionDuration: const Duration(milliseconds: 600),
                      pageBuilder: (BuildContext context, Animation<double> animation,
                              Animation<double> secondaryAnimation) =>
                          CourseDetailPage(course: scheduledClass.course),
                      transitionsBuilder: (BuildContext context, Animation<double> animation,
                          Animation<double> secondaryAnimation, Widget child) {
                        return FadeThroughTransition(
                            animation: animation,
                            secondaryAnimation: secondaryAnimation,
                            child: child);
                      },
                    ),
                  );
                },
                style: OutlinedButton.styleFrom(
                  side: BorderSide(color: _customColorScheme.primary),
                  foregroundColor: _customColorScheme.primary,
                  padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 10),
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
                ),
                child: const Text('View Course'),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
